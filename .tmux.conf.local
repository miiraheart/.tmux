# : << 'EOF'
# Oh my tmux! - Customized for Mira
# https://github.com/gpakosz/.tmux
# Plugin-free configuration optimized for ZSA Voyager keyboard
# Based on ~/.config/tmux settings

# -- bindings ------------------------------------------------------------------

tmux_conf_preserve_stock_bindings=false

# -- session creation ----------------------------------------------------------

tmux_conf_new_session_prompt=false
tmux_conf_new_session_retain_current_path=true

# -- windows & pane creation ---------------------------------------------------

tmux_conf_new_window_retain_current_path=true
tmux_conf_new_window_reconnect_ssh=false
tmux_conf_new_pane_retain_current_path=true
tmux_conf_new_pane_reconnect_ssh=false

# -- display -------------------------------------------------------------------

tmux_conf_24b_colour=true

# -- theming -------------------------------------------------------------------

tmux_conf_theme=enabled

# Catppuccin Macchiato inspired colors
tmux_conf_theme_colour_1="#24273a"    # base
tmux_conf_theme_colour_2="#363a4f"    # surface0
tmux_conf_theme_colour_3="#8aadf4"    # blue
tmux_conf_theme_colour_4="#c6a0f6"    # mauve
tmux_conf_theme_colour_5="#a6da95"    # green
tmux_conf_theme_colour_6="#24273a"    # base
tmux_conf_theme_colour_7="#cad3f5"    # text
tmux_conf_theme_colour_8="#24273a"    # base
tmux_conf_theme_colour_9="#f5a97f"    # peach
tmux_conf_theme_colour_10="#f5bde6"   # pink
tmux_conf_theme_colour_11="#a6da95"   # green
tmux_conf_theme_colour_12="#939ab7"   # overlay1
tmux_conf_theme_colour_13="#cad3f5"   # text
tmux_conf_theme_colour_14="#24273a"   # base
tmux_conf_theme_colour_15="#363a4f"   # surface0
tmux_conf_theme_colour_16="#ed8796"   # red
tmux_conf_theme_colour_17="#cad3f5"   # text

# window style
tmux_conf_theme_window_fg="default"
tmux_conf_theme_window_bg="default"
tmux_conf_theme_highlight_focused_pane=false

# pane border style
tmux_conf_theme_pane_border_style=thin
tmux_conf_theme_pane_border="$tmux_conf_theme_colour_2"
tmux_conf_theme_pane_active_border="#c6a0f6"

# pane indicator
tmux_conf_theme_pane_indicator="$tmux_conf_theme_colour_4"
tmux_conf_theme_pane_active_indicator="$tmux_conf_theme_colour_4"

# status line style
tmux_conf_theme_message_fg="$tmux_conf_theme_colour_1"
tmux_conf_theme_message_bg="$tmux_conf_theme_colour_5"
tmux_conf_theme_message_attr="bold"

tmux_conf_theme_message_command_fg="$tmux_conf_theme_colour_5"
tmux_conf_theme_message_command_bg="$tmux_conf_theme_colour_1"
tmux_conf_theme_message_command_attr="bold"

# window modes style
tmux_conf_theme_mode_fg="$tmux_conf_theme_colour_1"
tmux_conf_theme_mode_bg="$tmux_conf_theme_colour_5"
tmux_conf_theme_mode_attr="bold"

# status line
tmux_conf_theme_status_fg="$tmux_conf_theme_colour_3"
tmux_conf_theme_status_bg="$tmux_conf_theme_colour_1"
tmux_conf_theme_status_attr="none"

# terminal title
tmux_conf_theme_terminal_title="#{pane_title}"

# window status
tmux_conf_theme_window_status_fg="$tmux_conf_theme_colour_12"
tmux_conf_theme_window_status_bg="$tmux_conf_theme_colour_1"
tmux_conf_theme_window_status_attr="none"
tmux_conf_theme_window_status_format="#I:#W#{?window_marked_flag,M, }"

# current window status
tmux_conf_theme_window_status_current_fg="$tmux_conf_theme_colour_7"
tmux_conf_theme_window_status_current_bg="$tmux_conf_theme_colour_4"
tmux_conf_theme_window_status_current_attr="bold"
tmux_conf_theme_window_status_current_format="#I:#W#{?window_zoomed_flag,(), }"

# activity
tmux_conf_theme_window_status_activity_fg="default"
tmux_conf_theme_window_status_activity_bg="default"
tmux_conf_theme_window_status_activity_attr="italics"

# bell
tmux_conf_theme_window_status_bell_fg="$tmux_conf_theme_colour_9"
tmux_conf_theme_window_status_bell_bg="default"
tmux_conf_theme_window_status_bell_attr="blink,bold"

# last window
tmux_conf_theme_window_status_last_fg="$tmux_conf_theme_colour_4"
tmux_conf_theme_window_status_last_bg="$tmux_conf_theme_colour_2"
tmux_conf_theme_window_status_last_attr="none"

# separators (minimal style)
tmux_conf_theme_left_separator_main=""
tmux_conf_theme_left_separator_sub="|"
tmux_conf_theme_right_separator_main=""
tmux_conf_theme_right_separator_sub="|"

# status content
tmux_conf_theme_status_left=" [#S] "
tmux_conf_theme_status_right=" #{prefix}#{mouse}#{pairing}#{synchronized} | %H:%M | %d %b "

# status left/right style
tmux_conf_theme_status_left_fg="$tmux_conf_theme_colour_7,$tmux_conf_theme_colour_7"
tmux_conf_theme_status_left_bg="$tmux_conf_theme_colour_4,$tmux_conf_theme_colour_2"
tmux_conf_theme_status_left_attr="bold,none"

tmux_conf_theme_status_right_fg="$tmux_conf_theme_colour_12,$tmux_conf_theme_colour_7,$tmux_conf_theme_colour_7"
tmux_conf_theme_status_right_bg="$tmux_conf_theme_colour_1,$tmux_conf_theme_colour_2,$tmux_conf_theme_colour_4"
tmux_conf_theme_status_right_attr="none,none,bold"

# indicators
tmux_conf_theme_pairing=""
tmux_conf_theme_prefix=""
tmux_conf_theme_prefix_fg="$tmux_conf_theme_colour_9"
tmux_conf_theme_prefix_bg="none"
tmux_conf_theme_prefix_attr="bold"

tmux_conf_theme_mouse=""
tmux_conf_theme_mouse_fg="$tmux_conf_theme_colour_5"
tmux_conf_theme_mouse_bg="none"
tmux_conf_theme_mouse_attr="none"

tmux_conf_theme_root="!"
tmux_conf_theme_root_fg="$tmux_conf_theme_colour_16"
tmux_conf_theme_root_bg="none"
tmux_conf_theme_root_attr="bold,blink"

tmux_conf_theme_synchronized=""
tmux_conf_theme_synchronized_fg="$tmux_conf_theme_colour_9"
tmux_conf_theme_synchronized_bg="none"
tmux_conf_theme_synchronized_attr="bold"

# battery (disabled for minimal look)
tmux_conf_battery_bar_symbol_full=""
tmux_conf_battery_bar_symbol_empty=""
tmux_conf_battery_bar_length="0"

# clock style
tmux_conf_theme_clock_colour="$tmux_conf_theme_colour_4"
tmux_conf_theme_clock_style="24"

# -- clipboard -----------------------------------------------------------------

tmux_conf_copy_to_os_clipboard=true

# -- tpm -----------------------------------------------------------------------

# Disabled - this config is plugin-free
tmux_conf_update_plugins_on_launch=false
tmux_conf_update_plugins_on_reload=false
tmux_conf_uninstall_plugins_on_reload=true

# -- user customizations -------------------------------------------------------

# ╭─────────────────────────────────────────────────────────────────────────────╮
# │ CORE SETTINGS (from ~/.config/tmux/core.conf)                               │
# ╰─────────────────────────────────────────────────────────────────────────────╯

# Terminal settings
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -as terminal-features ",*:RGB"
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'

# Mouse support
set -g mouse on

# Prefix: Ctrl-Space (optimized for ZSA Voyager thumb cluster) #!important
set -gu prefix2
unbind C-b
unbind C-a
set -g prefix C-Space
bind C-Space send-prefix

# Window/pane numbering
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# History and buffer
set -g history-limit 50000
set -g buffer-limit 20

# Activity monitoring
set -g monitor-activity off
set -g visual-activity off

# Focus events
set -g focus-events on

# Escape time (important for vim)
set -sg escape-time 0

# Display times
set -g display-time 4000
set -g display-panes-time 3000

# Status interval
set -g status-interval 5

# Aggressive resize
setw -g aggressive-resize on

# Detach behavior
set -g detach-on-destroy off

# Terminal titles
set -g set-titles on
set -g set-titles-string '#{pane_title}'

# Default shell
set -g default-shell /bin/zsh

# Passthrough for images
set -g allow-passthrough on

# Extended keys
set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'

# Popup settings
set -g popup-border-lines rounded

# Word separators
set -g word-separators " -_@"

# Status position
set-option -g status-position bottom

# ╭─────────────────────────────────────────────────────────────────────────────╮
# │ COPY MODE (from ~/.config/tmux/copy.conf)                                   │
# ╰─────────────────────────────────────────────────────────────────────────────╯

# Vi-style bindings
setw -g mode-keys vi
set -s set-clipboard off

# Exit/clear selection
bind -T copy-mode-vi Escape if -F "#{selection_present}" { send -X clear-selection } { send -X cancel }

# Selection
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Copy operations
bind -T copy-mode-vi y send -X copy-pipe-and-cancel
bind -T copy-mode-vi Y { send-keys -X begin-selection; send-keys -X end-of-line; send-keys -X copy-pipe-and-cancel }
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel

# Mouse support in copy mode
bind -T copy-mode-vi MouseDown1Pane { select-pane; send -X clear-selection }
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-no-clear
bind -T copy-mode-vi DoubleClick1Pane { select-pane; send-keys -X select-word; send-keys -X copy-pipe-and-cancel }
bind -T copy-mode-vi TripleClick1Pane { select-pane; send-keys -X select-line; send-keys -X copy-pipe-and-cancel }

# Search
set -g wrap-search on
bind -T copy-mode-vi / command-prompt -i -p "(search down)" { send -X search-forward-incremental "%%%" }
bind -T copy-mode-vi ? command-prompt -i -p "(search up)" { send -X search-backward-incremental "%%%" }
bind / copy-mode \; send ?

# Prompt navigation
bind -T copy-mode-vi "[" send -X previous-prompt -o
bind -T copy-mode-vi "]" send -X next-prompt
bind "[" { copy-mode; send -X previous-prompt -o }
bind "]" { copy-mode; send -X next-prompt }

# URL search
bind C-u copy-mode \; send -X search-backward "(https?://|git@|git://|ssh://|ftp://|file:///)[[:alnum:]?=%/_.:,;~@!#$&()*+-]*"

# Mouse wheel scrolling
bind -n WheelUpPane if -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -e; send -X -N 5 scroll-up }
bind -T copy-mode-vi WheelUpPane { select-pane; send -X clear-selection; send -X -N 5 scroll-up }
bind -T copy-mode-vi WheelDownPane { select-pane; send -X clear-selection; send -X -N 5 scroll-down }

# ╭─────────────────────────────────────────────────────────────────────────────╮
# │ NAVIGATION (from ~/.config/tmux/navigation.conf)                           │
# ╰─────────────────────────────────────────────────────────────────────────────╯

# Alt+hjkl for pane navigation (fallback without tmux.nvim)
bind -n M-h if -F '#{pane_at_left}' {} { select-pane -L }
bind -n M-j if -F '#{pane_at_bottom}' {} { select-pane -D }
bind -n M-k if -F '#{pane_at_top}' {} { select-pane -U }
bind -n M-l if -F '#{pane_at_right}' {} { select-pane -R }

# Disable arrow keys (encourage hjkl)
unbind Up
unbind Down
unbind Left
unbind Right

# ╭─────────────────────────────────────────────────────────────────────────────╮
# │ KEYBINDINGS (from ~/.config/tmux/keybindings.conf)                          │
# ╰─────────────────────────────────────────────────────────────────────────────╯

# -- Core System Bindings --

# Reload config
unbind r
bind -N "Reload configuration" r source-file ~/.tmux.conf.local \; display-message "Config reloaded!"

# Command prompt
bind -N "Command prompt" : command-prompt

# Clear screen and history
bind -N "Clear screen and history" C-l send-keys 'C-l' \; run 'sleep 0.1' \; clear-history

# -- Session Management --

bind -N "List sessions" s choose-tree -Zs
bind -N "Create new session" S command-prompt -p "New session:" "new-session -s '%%'"
bind -N "Kill session" D kill-session
bind -N "Detach client" d detach-client

# -- Window Management --

bind -N "List windows" w choose-window
bind -N "Create new window" c new-window -c "#{pane_current_path}" #!important
bind -N "Create named window" W command-prompt -p "New window:" "new-window -n '%%'"
bind -N "Kill pane" x kill-pane
bind -N "Kill window" X kill-window
bind -N "Last window" a last-window
bind -N "Rename window" A command-prompt -p "Rename window:" "rename-window '%%'"

# Move windows
bind -N "Move window left" -r < swap-window -t -1 \; previous-window
bind -N "Move window right" -r > swap-window -t +1 \; next-window

# Direct window selection (Alt+1-9)
bind -N "Select window 1" -n M-1 select-window -t 1
bind -N "Select window 2" -n M-2 select-window -t 2
bind -N "Select window 3" -n M-3 select-window -t 3
bind -N "Select window 4" -n M-4 select-window -t 4
bind -N "Select window 5" -n M-5 select-window -t 5
bind -N "Select window 6" -n M-6 select-window -t 6
bind -N "Select window 7" -n M-7 select-window -t 7
bind -N "Select window 8" -n M-8 select-window -t 8
bind -N "Select window 9" -n M-9 select-window -t 9

# -- Pane Management --

# Splits
bind -N "Split vertically" | split-window -h -c "#{pane_current_path}" #!important
bind -N "Split horizontally" - split-window -v -c "#{pane_current_path}" #!important

# Resize (coarse)
bind -N "Resize pane left" -r H resize-pane -L 5
bind -N "Resize pane down" -r J resize-pane -D 5
bind -N "Resize pane up" -r K resize-pane -U 5
bind -N "Resize pane right" -r L resize-pane -R 5

# Resize (fine)
bind -N "Resize pane left fine" -r M-H resize-pane -L 1
bind -N "Resize pane down fine" -r M-J resize-pane -D 1
bind -N "Resize pane up fine" -r M-K resize-pane -U 1
bind -N "Resize pane right fine" -r M-L resize-pane -R 1

# Zoom
bind -N "Toggle zoom" z resize-pane -Z

# Layout
bind -N "Next layout" Space next-layout

# Break pane
bind -N "Break pane" b break-pane

# Mark/swap
bind -N "Mark pane" m select-pane -m
bind -N "Swap with marked" M swap-pane

# -- Copy Mode --

bind -N "Enter copy mode" v copy-mode
bind -N "Enter copy mode alt" [ copy-mode
bind -N "Paste buffer" ] paste-buffer

# -- Development & Productivity --

# Floating terminal popup (replaces floax plugin) - same binding as original
bind -N "Floating terminal" p display-popup -w 80% -h 80% -E -d "#{pane_current_path}" -b rounded

# Lazygit popup
bind -N "Open lazygit" g display-popup -w 80% -h 80% -E -d "#{pane_current_path}" "lazygit"

# File manager (yazi)
bind -N "File manager" F display-popup -w 80% -h 80% -E -d "#{pane_current_path}" "yazi"

# System monitor
bind -N "System monitor" h split-window -h -l 30% "btop"

# Python REPL (moved to C-p to avoid conflict with floating terminal)
bind -N "Python REPL" C-p display-popup -E "ipython --no-banner 2>/dev/null || python3"

# Quick notes
bind -N "Quick notes" n display-popup -w 80% -h 80% -E "nvim ~/notes/scratch.md"

# -- Quick Actions --

bind -N "Display pane numbers" q display-panes
bind -N "Kill server" Q kill-server
bind -N "Show keybindings" ? list-keys
bind -N "Show info" i display-message "Pane: #P | Window: #I:#W | Session: #S"

# -- Advanced Features --

# Sync panes toggle
bind -N "Sync panes toggle" C-s setw synchronize-panes \; display-message "Sync: #{?pane_synchronized,ON,OFF}"

# -- Notification Controls --

bind -N "Toggle all notifications" C-n if -F '#{monitor-activity}' \
    'set -g monitor-activity off; set -g monitor-bell off; set -g bell-action none; set -g activity-action none; display-message "Notifications: OFF"' \
    'set -g monitor-activity on; set -g monitor-bell on; set -g bell-action other; set -g activity-action other; display-message "Notifications: ON"'

bind -N "Toggle activity notifications" C-a if -F '#{monitor-activity}' \
    'set -g monitor-activity off; set -g activity-action none; display-message "Activity notifications: OFF"' \
    'set -g monitor-activity on; set -g activity-action other; display-message "Activity notifications: ON"'

bind -N "Show notification status" C-i display-message "Activity: #{?monitor-activity,ON,OFF} | Bell: #{bell-action}"

# -- Mouse Toggle --

bind m run "cut -c3- '#{TMUX_CONF}' | sh -s _toggle_mouse" \; display 'mouse #{?#{mouse},on,off}'

# ------------------------------------------------------------------------------

# /!\ do not remove the following line
# EOF
#
# "$@"
# /!\ do not remove the previous line
